<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="manifest" href="./manifest.webmanifest">
<link rel="icon" href="./icons/icon-192.png">
<meta name="theme-color" content="#f16e00">

<!-- iOS (Safari) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="icons/icon-192.png">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <meta name="theme-color" content="#ff6a00" />
  <title>ONU Suivi Stock — Trebuchet</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="pelichet-theme">
  <header class="app-header">
    <h1>ONU — Suivi Stock</h1>
    <div class="right">
      <button id="btnReload" class="secondary">↻ Recharger</button>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab-button active" data-tab="tab-reappro">Réappro</button>
    <button class="tab-button" data-tab="tab-dashboard">Dashboard</button>
    <button class="tab-button" data-tab="tab-avance">Fonctionnalités avancées</button>
  </nav>

  <main>
    <!-- =============== RÉAPPRO =============== -->
    <section id="tab-reappro" class="tab-panel">
      <!-- Besoins J+1 -->
      <div class="card">
        <h2>Besoins J+1 — Saisie</h2>
        <div class="grid grid-4 grid-sm-2 grid-xs-1">
          <div>
            <label>Jour J+1</label>
            <input type="date" id="b_j1">
          </div>
          <div>
            <label>Équipe</label>
            <select id="b_equipe"></select>
          </div>
          <div class="align-end">
            <button id="b_add_row" class="secondary">+ Ajouter une ligne</button>
          </div>
          <div class="align-end right">
            <button id="b_save" class="primary">Enregistrer les besoins</button>
          </div>
        </div>
        <div class="table-wrap scroll-x" style="margin-top:10px;">
          <table id="b_table">
            <thead>
              <tr>
                <th style="min-width:220px;">Matériel</th>
                <th style="min-width:120px;">Cible (quantité)</th>
                <th style="min-width:200px;">Commentaire</th>
                <th>—</th>
              </tr>
            </thead>
            <tbody><!-- lignes dynamiques --></tbody>
          </table>
        </div>
        <p class="muted">Astuce : ajoute plusieurs lignes pour la même équipe puis “Enregistrer les besoins”.</p>
      </div>

      <!-- Plan J+1 -->
      <div class="card">
        <h2>Plan J+1 — Calcul / Mouvements</h2>
        <div class="grid grid-4 grid-sm-2 grid-xs-1">
          <div>
            <label>Jour J</label>
            <input type="date" id="r_jour" />
          </div>
          <div>
            <label>Jour J+1</label>
            <input type="date" id="r_jour1" />
          </div>
          <div class="stretch"></div>
          <div class="align-end right">
            <button id="r_calc" class="primary">Calculer le plan</button>
            <button id="r_gen_vc_bib">VC → Bibliothèque</button>
            <button id="r_distribuer">Bibliothèque → Équipes</button>
          </div>
        </div>
        <div class="row-2">
          <div><h3>Détails (par équipe)</h3><div id="r_details" class="table-wrap scroll-x">—</div></div>
          <div><h3>Agrégat (VC→Biblio)</h3><div id="r_agregat" class="table-wrap scroll-x">—</div></div>
        </div>
      </div>

      <!-- Clôture J -->
      <div class="card">
        <h2>Clôture J — Restes d'équipe</h2>
        <div class="grid grid-3 grid-sm-2 grid-xs-1">
          <div><label>Date (J)</label><input type="date" id="c_date" /></div>
          <div><label>Équipe</label><select id="c_equipe"></select></div>
          <div><label>Zone (auto = équipe)</label><input type="text" id="c_zone" placeholder="auto" /></div>
        </div>
        <textarea id="c_csv" rows="6" class="monospace" placeholder="Matériel, Quantité"></textarea>
        <div class="toolbar right"><button id="c_save" class="primary">Enregistrer les restes</button></div>
      </div>
    </section>

    <!-- =============== DASHBOARD =============== -->
    <section id="tab-dashboard" class="tab-panel hidden">
      <!-- Graphique Stock VC (Top 10) -->
<div class="card">
  <h3>Stock Voie Creuse — Top 10</h3>
  <canvas id="chartVC" height="140"></canvas>
</div>

<!-- Graphiques Besoins J+1 -->
<div class="grid-2">
  <div class="card">
    <h3>Besoins J+1 — par équipe</h3>
    <canvas id="chartBesoinsTeam" height="160"></canvas>
  </div>
  <div class="card">
    <h3>Besoins J+1 — par matériel</h3>
    <canvas id="chartBesoinsMat" height="160"></canvas>
  </div>
</div>

<!-- Historique d’usage -->
<div class="card">
  <h3>Usage quotidien — par équipe</h3>
  <canvas id="chartUsageTeams" height="180"></canvas>
</div>

      
      <div class="card">
        <h2>Dashboard — Synthèse</h2>
        <div id="chartVCPieWrap"></div>
        <div id="chartBesoinsPerTeamWrap"></div>
        <div id="chartUsagePerTeamWrap"></div>

        <div class="grid grid-4 grid-sm-2 grid-xs-1">
          <div><label>Jour J</label><input type="date" id="dashJ" /></div>
          <div><label>Jour J+1</label><input type="date" id="dashJ1" /></div>
          <div><label>Usage — du</label><input type="date" id="dashFrom" /></div>
          <div><label>au</label><input type="date" id="dashTo" /></div>
        </div>
        <div class="toolbar wrap">
          <button id="btnDashRefresh" class="primary">Actualiser</button>
          <button id="btnDashExport" class="secondary">Exporter (XLSX)</button>
          <span id="dashMsg" class="muted"></span>
        </div>
      </div>
      <div class="kpis grid grid-3 grid-sm-2 grid-xs-1">
        <div class="kpi"><div class="kpi-title">Stock VC (articles)</div><div id="kpi-vc" class="kpi-value">—</div></div>
        <div class="kpi"><div class="kpi-title">Entrées Biblio (J)</div><div id="kpi-bibj" class="kpi-value">—</div></div>
        <div class="kpi"><div class="kpi-title">Répartition (J)</div><div id="kpi-repj" class="kpi-value">—</div></div>
      </div>
      <div class="card"><h3>Stock Voie Creuse (J)</h3><div id="dashStockVC" class="table-wrap scroll-x">—</div></div>
      <div class="card"><h3>Entrées du jour à Bibliothèque (J)</h3><div id="dashEntBibJ" class="table-wrap scroll-x">—</div></div>
      <div class="card"><h3>Entrées J+1 à Bibliothèque — Plan</h3><div id="dashEntBibJ1Plan" class="table-wrap scroll-x">—</div></div>
      <div class="card"><h3>Entrées J+1 à Bibliothèque — Réel</h3><div id="dashEntBibJ1Real" class="table-wrap scroll-x">—</div></div>
      <div class="card"><h3>Répartition du jour vers équipes (J)</h3><div id="dashRepartJ" class="table-wrap scroll-x">—</div></div>
      <div class="card"><h3>Besoins J+1 par équipe</h3><div id="dashBesoinsEqJ1" class="table-wrap scroll-x">—</div></div>
      <div class="card"><h3>Consommation — par jour & par équipe</h3><div id="dashUsage" class="table-wrap scroll-x">—</div></div>
    </section>

    <!-- =============== AVANCÉ =============== -->
    <section id="tab-avance" class="tab-panel hidden">
      <div class="card">
        <h2>Fonctionnalités avancées</h2>
        <div class="grid grid-3 grid-sm-2 grid-xs-1">
          <div><label>Zone (État des stocks par zone)</label><input type="text" id="a_zone" placeholder="Ex: Bibliothèque ou équipe 1" /></div>
          <div class="align-end"><button id="a_etat" class="primary">Charger</button></div>
        </div>
        <div id="a_etat_table" class="table-wrap scroll-x">—</div>
      </div>
      <div class="card">
        <h3>Export / Snapshot</h3>
        <div class="toolbar wrap">
          <button id="a_export_xlsx" class="secondary">Exporter (XLSX)</button>
          <button id="a_snapshot" class="secondary">Snapshot Restes (J)</button>
          <label class="switch"><input type="checkbox" id="a_lock" /><span>Verrou Snapshot</span></label>
        </div>
      </div>
    </section>
  </main>

  <script src="script.js"></script>
</body>
</html>
